---
highlight: a11y-dark
theme: smartblue
---
# åˆè¡·
ä»2018å¹´å¾®ä¿¡å°ç¨‹çš„çˆ†ç«ï¼Œåˆ°ç°åœ¨çš„å„å®¶å°ç¨‹åºã€è·¨å¹³å°å°ç¨‹åºæ¡†æ¶ã€‚å·²ç»å‡ºç°åœ¨å¤§å®¶ç”Ÿæ´»ä¸­ä¸‰å¹´äº†ï¼Œè€Œä¸”æœ‰ç€è¶Šæ¥è¶Šæ·±åº¦çš„ä½¿ç”¨ã€‚ç»è¿‡å‡ å¹´çš„å‘å±•å¾®ä¿¡å®˜æ–¹æä¾›äº†äº‘å¼€å‘çš„æ¨¡å¼ï¼Œæˆ‘å°±åœ¨æƒ³ä½œä¸ºä¸€ä½å¼€å‘è€…ï¼Œé‚£ä¸å°±æ˜¯å¯ä»¥å®ç°å½“åˆå…¨æ ˆå·¥ç¨‹å¸ˆçš„ç›®æ ‡äº†ä¹ˆã€‚æ‰€ä»¥æœ‰äº†è¿™ç¯‡æ–‡ç« ï¼Œæ˜¯æˆ‘æƒ³æˆä¸ºå…¨æ ˆå·¥ç¨‹å¸ˆçš„ç¬¬ä¸€æ­¥ï¼Œä¹Ÿå¸Œæœ›æ˜¯ä½ ä»¬çš„ç¬¬ä¸€æ­¥ã€‚
# é¡¹ç›®ä»‹ç»
æœ‹å‹å¼€äº†ä¸€å®¶çœ¼é•œåº—ï¼Œè·Ÿæˆ‘è¯´äº†ä¸€ä¸‹èƒ½ä¸èƒ½åœ¨æ‰‹æœºä¸ŠæŠŠç”¨æˆ·ä¿¡æ¯è·å–åˆ°ï¼Œè€Œä¸”ç»´æŠ¤å¥½ä»–çœ¼ç›åº—çš„å®¢æˆ·ä¿¡æ¯ã€‚æˆ‘ä¸€æƒ³è¿™ä¸æ˜¯å°ç¨‹åºæ­£åˆé€‚å˜›ã€‚äºæ˜¯æˆ‘åœ¨ç½‘ä¸Šæ‰¾è¿™ç§çœ¼é•œåº—çš„è®¾è®¡ç¨¿ï¼Œæ‰¾å¥½ä¹‹åï¼ŒæŒ‰ç…§ä»–çš„éœ€æ±‚ï¼Œæœ‰å°ç¨‹åºé¢„çº¦åˆ°åº—åŠç†ä¸šåŠ¡ã€è®¢å•ç»´æŠ¤ã€ç”¨æˆ·ä¿¡æ¯ç»´æŠ¤ã€‚æœ‰äº†éœ€æ±‚ï¼Œè®¾è®¡ä¹Ÿæœ‰äº†ï¼Œæ­£å¥½ä½¿ç”¨å°ç¨‹åºçš„äº‘å¼€å‘æˆ‘å°±å¯ä»¥è‡ªå·±åšä¸€ä¸ªé¡¹ç›®äº†ã€‚

åœ¨è¿™ä¸ªé¡¹ç›®è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°çš„é—®é¢˜ï¼Œå¾ˆå€¼å¾—è®°å½•ä¸‹æ¥ã€‚äºæ˜¯è¡Œæ–‡ï¼Œå°†æˆ‘å®ç°è¿‡ç¨‹çš„ç§ç§ï¼Œä½œä¸ºåˆ†äº«ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°ä¸€äº›ç«¥é‹ã€‚
## é¡¹ç›®é¢„è§ˆ
### è°ƒç”¨æ¥å£
> ![Jan-04-2022 16-16-30.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/67c51ad2d8b94970ad9d6f4c1c4adb64~tplv-k3u1fbpfcp-watermark.image?)
### ç”¨æˆ·æ³¨å†Œ
> ![Jan-04-2022 16-22-27.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f85f20c8227e4efa9b1b8e15c149a03b~tplv-k3u1fbpfcp-watermark.image?)
### è®¢å•æäº¤
> ![Jan-04-2022 16-25-15.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1cab5bb41ed44bc08c65ab2bdca22852~tplv-k3u1fbpfcp-watermark.image?)
### è®¢å•ç»´æŠ¤
> ![Jan-04-2022 16-33-29.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68452ce16f57415cb4e01e064c75cdf6~tplv-k3u1fbpfcp-watermark.image?)
## é¡¹ç›®ä¿¡æ¯
> [Githubæºç åœ°å€:è·¯å®¢çœ¼é•œ](https://github.com/LookGlasses/LookMini) æœ‰éœ€è¦çš„æ¬¢è¿Fork ï¼Œå¦‚æœå–œæ¬¢ï¼Œè¯·ç»™ä¸ªStar~
# é¡¹ç›®å†…å®¹
## é¡¹ç›®ç›®å½•
```js
â”œâ”€â”€ README.md
â”œâ”€â”€ cloudfunctions // è¿™é‡Œæ˜¯äº‘å‡½æ•°çš„ä»£ç 
â”‚Â Â  â”œâ”€â”€ allOrderInfo
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ config.json
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.js
â”‚Â Â  â”‚Â Â  â””â”€â”€ package.json
â”‚Â Â  â”œâ”€â”€ orderInfo
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ config.json
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.js
â”‚Â Â  â”‚Â Â  â””â”€â”€ package.json
â”‚Â Â  â”œâ”€â”€ productInfo
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ config.json
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.js
â”‚Â Â  â”‚Â Â  â””â”€â”€ package.json
â”‚Â Â  â”œâ”€â”€ roleInfo
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ config.json
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index.js
â”‚Â Â  â”‚Â Â  â””â”€â”€ package.json
â”‚Â Â  â””â”€â”€ userInfo
â”‚Â Â      â”œâ”€â”€ config.json
â”‚Â Â      â”œâ”€â”€ index.js
â”‚Â Â      â”œâ”€â”€ package-lock.json
â”‚Â Â      â””â”€â”€ package.json
â”œâ”€â”€ img // è¿™é‡Œæ˜¯æœ¬åœ°çš„ä¸€äº›å›¾ç‰‡ï¼Œå› ä¸ºæˆ‘é¡¹ç›®é‡Œå·²ç»ä½¿ç”¨äº‘å­˜å‚¨å±•ç¤ºå›¾ç‰‡è¿™é‡Œæ–¹ä¾¿æ‹‰å»ä»£ç åå±•ç¤ºå›¾ç‰‡
â”‚Â Â  â”œâ”€â”€ T1.png
â”‚Â Â  â”œâ”€â”€ T2.png
â”‚Â Â  â”œâ”€â”€ T3.png
â”‚Â Â  â”œâ”€â”€ T3_more.png
â”‚Â Â  â”œâ”€â”€ banner1.jpeg
â”‚Â Â  â”œâ”€â”€ banner2.jpeg
â”‚Â Â  â””â”€â”€ qrcode.jpg
â”œâ”€â”€ miniprogram // å°ç¨‹åºä»£ç ç›®å½•
â”‚Â Â  â”œâ”€â”€ app.js
â”‚Â Â  â”œâ”€â”€ app.json
â”‚Â Â  â”œâ”€â”€ app.wxss
â”‚Â Â  â”œâ”€â”€ components
â”‚Â Â  â”‚Â Â  â””â”€â”€ cloudTipModal
â”‚Â Â  â”œâ”€â”€ envList.js
â”‚Â Â  â”œâ”€â”€ images
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ BLUE_2.jpeg
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ GLASSES.jpeg
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ USER.png
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ arrow.png
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ black.jpeg
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ blue.jpeg
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ call.png
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ class.jpeg
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ detail.jpeg
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ glass
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ jinhangzhong.png
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ pink.jpeg
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ quchu.png
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ submit.png
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ tab
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ tea.jpeg
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ weifukuan.png
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ white.jpeg
â”‚Â Â  â”‚Â Â  â””â”€â”€ yiwancheng.png
â”‚Â Â  â”œâ”€â”€ miniprogram_npm
â”‚Â Â  â”‚Â Â  â””â”€â”€ @miniprogram-component-plus
â”‚Â Â  â”œâ”€â”€ package-lock.json
â”‚Â Â  â”œâ”€â”€ package.json
â”‚Â Â  â”œâ”€â”€ pages
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ allOrderInfo
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ appointment //é¢„çº¦
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ confirmOrder
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ glasses //é…é•œ
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ goodsDetail 
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index //é¦–é¡µ
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ map
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ orderInfo
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ orderResult
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ updateOrder
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ user //ä¸ªäººä¸­å¿ƒ
â”‚Â Â  â”‚Â Â  â””â”€â”€ userInfo
â”‚Â Â  â””â”€â”€ sitemap.json
â”œâ”€â”€ project.config.json
â”œâ”€â”€ project.private.config.json
â””â”€â”€ uploadCloudFunction.sh
```
### é¡¹ç›®åœ¨äº‘å¼€å‘æ—¶çš„é…ç½®
äº‘å¼€å‘åˆå§‹åŒ–ç­‰é…ç½®åœ¨å®˜æ–¹æ–‡æ¡£ä¸­å†™çš„å¾ˆæ¸…æ¥šäº†ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜éƒ½å¯ä»¥å»[å®˜æ–¹æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/quick-start/miniprogram.html)æŸ¥è¯¢ã€‚
æˆ‘ä»¬ç›´æ¥å¼€å§‹ä»‹ç»æœ¬é¡¹ç›®åœ¨è¿è¡Œæ—¶çš„é…ç½®ï¼š
- **åœ¨äº‘å¼€å‘æ•°æ®åº“ç›®å½•ä¸‹æ–°å»ºå››ä¸ªé›†åˆï¼šorder_infoã€product_infoã€role_infoã€user_infoã€‚**
> ![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8db7e79b4f8845d6aa22f60d428ca89e~tplv-k3u1fbpfcp-watermark.image?)
> 
> order_info å­˜å‚¨ç”¨æˆ·è®¢å•ä¿¡æ¯ã€product_info å­˜å‚¨äº§å“ä¿¡æ¯ã€role_info å­˜å‚¨è§’è‰²ä¿¡æ¯ã€user_info å­˜å‚¨ç”¨æˆ·ä¿¡æ¯
- **å°†cloudfunctionsç›®å½•ä¸­çš„äº‘å‡½æ•°ä¸Šä¼ å¹¶éƒ¨ç½²**
> ![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5287cdee1834040956977c0bbe906e7~tplv-k3u1fbpfcp-watermark.image?)
> ![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/492b87da11dd4833b583d349a3e27be2~tplv-k3u1fbpfcp-watermark.image?)
### ç”¨æˆ·æ³¨å†Œ
å¾®ä¿¡å°ç¨‹åºç”¨æˆ·ä¿¡æ¯æˆæƒçœŸçš„æ˜¯æ”¹äº†å¥½å¤šæ¬¡ï¼Œç°åœ¨è¦è·å–ç”¨æˆ·å¤´åƒæ˜µç§°ä¿¡æ¯ç­‰è¦ä½¿ç”¨[getUserProfile API](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/wx.getUserProfile.html)ï¼ŒåŸæ¥ä½¿ç”¨Buttonç»„ä»¶ç”¨open-typeè¿˜èƒ½è·å–ä¿¡æ¯ä½†æ˜¯åœ¨çœŸæœºä¸Šå±•ç¤ºä¸äº†ç”¨æˆ·ä¿¡æ¯ã€‚
> ![Jan-04-2022 16-22-27.gif](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f85f20c8227e4efa9b1b8e15c149a03b~tplv-k3u1fbpfcp-watermark.image?)

```js
pages/user/index
wxmlä»£ç ï¼š
 <view class="header-icon-box color-fff text-center">
      <block wx:if="{{islogin}}">
        <image class="header-icon block" src="/images/USER.png"></image>
        <!-- <button class="header-icon-btn bg-blue color-fff" open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber">è·å–æ‰‹æœºå·</button> -->
        <button wx:if="{{userParam.errMsg}}" class="header-icon-btn bg-blue color-fff" open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber">ç»‘å®šæ‰‹æœºå·</button>
        <button wx:else class="header-icon-btn bg-blue color-fff" bindtap="handleUserInfo">è¯·ç‚¹å‡»ç™»é™†</button>
      </block>
      <block wx:else>
        <image class="header-icon block" src="{{userData.avatarUrl}}"></image>
        <view class="color-fff">{{userData.nickName}}</view>
      </block>
 </view>
 jsä»£ç ï¼š
   handleUserInfo() {
    wx.getUserProfile({
      desc: 'ç”¨äºå®Œå–„ä¼šå‘˜èµ„æ–™', // å£°æ˜è·å–ç”¨æˆ·ä¸ªäººä¿¡æ¯åçš„ç”¨é€”ï¼Œåç»­ä¼šå±•ç¤ºåœ¨å¼¹çª—ä¸­ï¼Œè¯·è°¨æ…å¡«å†™
      success: (res) => {
        console.log(res)
        if (res.errMsg === 'getUserProfile:ok') {
          this.setData({
            userParam: res
          })
        } else {
          this.setData({
            islogin: true
          });
        }
      }
    })
  },
  getPhoneNumber(e) {
    wx.showLoading({
      title: 'åŠ è½½ä¸­',
    })
    wx.cloud.callFunction({
        name: 'userInfo',
        data: {
          method: 'POST',
          param: {
            ...this.data.userParam,
          },
          weRunData: wx.cloud.CloudID(e.detail.cloudID), // æ­¤å¤„æ˜¯æ‰‹æœºå·çš„æ•°æ®
        },
      })
      .then(res => {
        wx.hideLoading()
        console.log(res)
        const data = {
          role: res.result.role,
          openid: res.result.openid,
          moblie: res.result.moblie,
          ...res.result.userInfo
        }
        this.setData({
          islogin: false,
          userData: data
        });
        wx.setStorageSync('UserInfo', data)
      })
  },
```
è¿™é‡Œå› ä¸ºæœ‹å‹æ˜¯æ³¨å†Œå…¬å¸çš„å¯ä»¥é€šè¿‡å¾®ä¿¡è®¤è¯ï¼Œæ‰€ä»¥åœ¨ç”¨æˆ·æ³¨å†Œçš„æ—¶å€™å¢åŠ çš„æ‰‹æœºå·çš„ç»´åº¦ã€‚å¤§å®¶åœ¨è¿è¡Œé¡¹ç›®çš„æ—¶å€™å¯ä»¥é…Œæƒ…ä¿®æ”¹é€»è¾‘ã€‚ç”¨æˆ·ä¿¡æ¯æ¥å£ä»£ç åœ¨ä¸‹é¢ä¸ºå¤§å®¶è´´å‡ºæ¥ï¼Œçœ‹èµ·æ¥æ›´æ–¹ä¾¿ã€‚

```js
// äº‘å‡½æ•°å…¥å£æ–‡ä»¶
const cloud = require('wx-server-sdk')
cloud.init()
const db = cloud.database({
  env: cloud.DYNAMIC_CURRENT_ENV, // è¿™ä¸ªæ˜¯ä½¿ç”¨é»˜è®¤ç¯å¢ƒIDçš„å˜é‡
})


// äº‘å‡½æ•°å…¥å£å‡½æ•°
exports.main = async (event, context) => {
  const wxContext = cloud.getWXContext()
  switch (event.method) { 
    case "GET": // è¿™é‡Œæ˜¯è·å–ç”¨æˆ·æ•°æ®åˆ—è¡¨çš„é€»è¾‘
      if (event.param.moblie) {
        return db.collection('user_info')
          .where({
            moblie: event.param.moblie,
          }).skip(event.param.page * event.param.size).limit(event.param.size).get() // skipæ˜¯æ¥åšåˆ†é¡µçš„é€»è¾‘
      }
      return db.collection('user_info')
        .skip(event.param.page * event.param.size).limit(event.param.size).get()
      break;
    case "POST":
      const moblie = event.weRunData.data.phoneNumber;
      let role = 'others'
      const userInfo = db.collection('user_info')
      // è¿™é‡Œæ˜¯é…ç½®ç”¨æˆ·è§’è‰²ä¿¡æ¯ç”¨æ¥åŒºåˆ†ç®¡ç†å‘˜å’Œç”¨æˆ·çš„è§’è‰²
      return db.collection('role_info')
        .get().then((res) => {
          res.data.map((item, index) => {
            if (item.openid === wxContext.OPENID) { //æ ¹æ®ç”¨æˆ·æ³¨å†Œåçš„openidæ¥åˆ¤æ–­
              role = item.role
            }
          })
          const userItem = userInfo.where({
            openid: wxContext.OPENID
          }).get().then(res => {
          // è¿™é‡Œå…ˆåˆ¤æ–­ç”¨æˆ·ä¿¡æ¯æ˜¯å¦å­˜åœ¨
            if (res.data.length === 0) {
              console.log('------add')
              userInfo.add({
                data: {
                  ...event.param,
                  openid: wxContext.OPENID,
                  appid: wxContext.APPID,
                  unionid: wxContext.UNIONID,
                  create: new Date(),
                  update: new Date(),
                  role: role,
                  moblie
                }
              })
            } else {
              console.log('------update')
              userInfo.where({
                openid: wxContext.OPENID
              }).update({
                data: {
                  ...event.param,
                  openid: wxContext.OPENID,
                  appid: wxContext.APPID,
                  unionid: wxContext.UNIONID,
                  update: new Date(),
                  role: role,
                  moblie
                }
              })
            }
            console.log('userItem-------', res)
          })
          return {
            ...event.param,
            openid: wxContext.OPENID,
            appid: wxContext.APPID,
            unionid: wxContext.UNIONID,
            role: role,
            moblie
          }
        })
      break;
    default:
      return {
        ...event.param,
          openid: wxContext.OPENID,
          appid: wxContext.APPID,
          unionid: wxContext.UNIONID,
      }
      break;
  }
}
```
### è®¢å•æäº¤
> ![Jan-04-2022 16-25-15.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1cab5bb41ed44bc08c65ab2bdca22852~tplv-k3u1fbpfcp-watermark.image?)

```js
// pages/confirmOrder/index.js
Page({

  /**
   * é¡µé¢çš„åˆå§‹æ•°æ®
   */
  data: {
    detail: {},
    userInfo: {}
  },

  /**
   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½
   */
  onLoad: function (options) {
    let userInfo = wx.getStorageSync('UserInfo');
    this.setData({
      detail: JSON.parse(options.item),
      userInfo
    })
  },

  /**
   * ç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’åˆ†äº«
   */
  onShareAppMessage: function () {

  },
  formSubmit(e) {
    console.log(e)

    const formData = e.detail.value;
    let flag = false

    for (const key in formData) {
      if (formData[key]) {
        flag = true
      } else {
        flag = false
      }
    }
    if (flag) {
      wx.showLoading({
        title: 'é¢„çº¦ä¸­',
      })
      delete this.data.detail._id
      wx.cloud.callFunction({ // è¿™é‡Œè°ƒç”¨orderçš„äº‘å‡½æ•°è¿›è¡Œè®¢å•æäº¤
        name: 'orderInfo',
        data: {
          method: 'POST',
          param: {
            orderStatus: "PENDING",
            ...formData,
            ...this.data.userInfo,
            ...this.data.detail
          }
        },
      }).then(res => {
        console.log(res)
        wx.hideLoading()
        wx.navigateTo({
          url: '/pages/orderResult/index',
        })
      })

    } else {
      wx.showToast({
        title: 'è¯·å¡«å†™å®Œæ•´ä¿¡æ¯ï½',
        icon: 'none'
      })
    }

  }
})
```
orderinfoäº‘å‡½æ•°çš„ä»£ç ï¼š

```js
// äº‘å‡½æ•°å…¥å£æ–‡ä»¶
const cloud = require('wx-server-sdk')
cloud.init()
const db = cloud.database({
  env: cloud.DYNAMIC_CURRENT_ENV,
})
exports.main = async (event, context) => {
  const wxContext = cloud.getWXContext()
  const orderInfo = db.collection('order_info')
  switch (event.method) {
    case "GET":
      if (event.param.orderStatus === "ALL") {
        return orderInfo
          .where({
            openid: wxContext.OPENID,
          }).orderBy('create', 'desc').skip(event.param.page * event.param.size).limit(event.param.size).get()
      }
      return orderInfo
        .where({
          openid: wxContext.OPENID,
          orderStatus: event.param.orderStatus
        }).orderBy('create', 'desc').skip(event.param.page * event.param.size).limit(event.param.size).get()
      break;
    case "POST": // è¿™é‡Œè¿›è¡Œæäº¤è®¢å•çš„é€»è¾‘
      // delete event.method
      console.log(event.param)
      if (event.param._id) {
        return orderInfo
          .where({
            _id: event.param._id
          }).update({
            data: {
              orderStatus: event.param.orderStatus,
            }
          })
      }
      return orderInfo
        .add({
          data: {
            ...event.param,
            create: new Date()
          }
        })
      break;
    default:
      return orderInfo
        .get()
      break;
  }
}
```
### è®¢å•åˆ—è¡¨
> ![Jan-05-2022 11-16-27.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5dc0806d77d94100840b68b043233844~tplv-k3u1fbpfcp-watermark.image?)

```js
pages/orderInfo/index

getOrderInfo(status = "ALL") { //è·å–æ¥å£æ•°æ®
    wx.showLoading({
      title: 'åŠ è½½ä¸­',
    })
    wx.cloud.callFunction({
      name: 'orderInfo',
      data: {
        method: 'GET',
        param: {
          orderStatus: status,
          ...this.data.pageParam // åˆ†é¡µå‚æ•°
        }
      },
    }).then(res => {
      wx.hideLoading()
      const arr = this.data.orderList.concat(res.result.data)
      this.setData({
        orderList: arr,
        onBottom: res.result.data.length === 0 || false
      })
    })
  },
  handleLower() { //ä¿®æ”¹åˆ†é¡µå‚æ•°
    const pageParam = this.data.pageParam;
    const index = this.data.activeTab
    pageParam.page++
    this.setData({
      pageParam
    })
    if (!this.data.onBottom) {
      this.getOrderInfo(this.data.tabs[index].status)
    }
  },
```
ä¸Šé¢ä¸¤æ®µä»£ç å°±æ˜¯ä¸»è¦å®Œæˆè®¢å•æŸ¥è¯¢çš„åŠŸèƒ½ï¼Œæ¥ä¸‹æ¥æ˜¯è®¢å•çš„äº‘å¼€å‘çš„æŸ¥è¯¢å’Œåˆ†é¡µçš„ä»£ç ï¼š

```js
// äº‘å‡½æ•°å…¥å£æ–‡ä»¶
const cloud = require('wx-server-sdk')
cloud.init()
const db = cloud.database({
  env: cloud.DYNAMIC_CURRENT_ENV,
})
exports.main = async (event, context) => {
  const wxContext = cloud.getWXContext()
  const orderInfo = db.collection('order_info')
  switch (event.method) {
    case "GET":
      if (event.param.orderStatus === "ALL") {
        return orderInfo
          .where({
            openid: wxContext.OPENID,
          }).orderBy('create', 'desc').skip(event.param.page * event.param.size).limit(event.param.size).get()
      }
      return orderInfo
        .where({
          openid: wxContext.OPENID,
          orderStatus: event.param.orderStatus
        }).orderBy('create', 'desc').skip(event.param.page * event.param.size).limit(event.param.size).get() // è¿™é‡Œä¸»è¦æ˜¯äº‘å¼€å‘çš„åˆ†é¡µé€»è¾‘
      break;
    case "POST":
      // delete event.method
      console.log(event.param)
      if (event.param._id) {
        return orderInfo
          .where({
            _id: event.param._id
          }).update({
            data: {
              orderStatus: event.param.orderStatus,
            }
          })
      }
      return orderInfo
        .add({
          data: {
            ...event.param,
            create: new Date()
          }
        })
      break;
    default:
      return orderInfo
        .get()
      break;
  }
}
```
[ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹äº‘å¼€å‘ç›¸å…³API](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/database/collection/Collection.skip.html)
# ç»“è¯­
ç”±äºé¡¹ç›®æ¯”è¾ƒå°ï¼Œå°±ä¸è´´å¾ˆå¤šä»£ç æ¥æ‹…è¯¯å¤§å®¶å®è´µçš„æ—¶é—´äº†ã€‚å¼ºçƒˆå»ºè®®å¤§å®¶å»cloneä»£ç è‡ªå·±è¿è¡Œèµ·æ¥ï¼Œå¤šç‚¹ç‚¹ï¼Œæ¯”çœ‹æ–‡ç« è¯´åŠå¤©ä¸å»å®è·µæ•ˆæœä¼šå¥½å¾ˆå¤šã€‚æ­¤æ–‡ç« ä¸»è¦æ˜¯æƒ³è®©å¤§å®¶å»å¤šå°è¯•å°è¯•äº‘å¼€å‘çš„æ¨¡å¼æ¥æ‹“å±•ä¸€ä¸‹æŠ€æœ¯æ ˆï¼Œè®©è‡ªå·±æŒæ¡åç«¯çš„ä¸€äº›çŸ¥è¯†ç‚¹ã€‚
è¿˜æœ‰å¤§å®¶çš„é¼“åŠ±ï¼Œæ˜¯æˆ‘æ¥ä¸‹æ¥æ›´æ–°çš„åŠ¨åŠ›ã€‚ä¹‹åçš„æ›´æ–°è®¡åˆ’ï¼šä½¿ç”¨RNå’ŒFlutteræ¥ç¿»å†™æ­¤å°ç¨‹åºï¼Œè€Œä¸”è¿˜æ˜¯è¦ç»“åˆå°ç¨‹åºçš„äº‘å¼€å‘æ¥åšAPP ğŸ‰ğŸ‰ğŸ‰

> [å†æ¬¡é™„ä¸Šé¡¹ç›®åœ°å€ï¼ˆçœ¼é•œåº—ï¼‰](https://github.com/LookGlasses/LookMini)
> 
> è¿˜æœ‰ä¸€ä¸ªæˆ‘å†™çš„ä¸€ä¸ªäº‘å¼€å‘çš„é¡¹ç›®ï¼Œæƒ³åšçš„æ˜¯æœ¬åœ°è¯çš„å›æ”¶ï¼Œæ¯”èµ·è¿™ä¸ªé¡¹ç›®åŠŸèƒ½å°‘ä¸€ç‚¹å¤§å®¶ä¹Ÿå¯ä»¥cloneè¿™ä¸ªé¡¹ç›®æ¥å°è¯•äº‘å¼€å‘ï¼š[æœ¬åœ°åŒ–å›æ”¶å°ç¨‹åº](https://github.com/SkyRecovery/SkyRecoverMini)
